import re

import requests
from openpyxl import workbook
from lxml import etree

url = 'http://www.baidu.com/s'
p = {
    'wd': '云上宜宾-高端对话',
    'pn': '0',
    'oq': '云上宜宾-高端对话',
    'ie': 'utf-8',
    'rsv_pq': 'ecec1b6400010dda',
    'rsv_t': 'd11cYlHMK36qYryJSbFBKYdTJLb2xYwdThMHGI8O1sAuetoxbChKI75SIPk',
    'gpc': 'stf=1672502400,1684166398|stftype=2',
    'tfflag': '1'
}
headers = {
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Cache-Control': 'max-age=0',
    'Connection': 'keep-alive',
    'Cookie': 'BAIDUID=5F8E42119938A55E90637C029A4C140A:FG=1; PSTM=1678530126; BIDUPSID=D4AA06A7B7C86CAD3189CDE4ED85C09B; BD_UPN=12314753; H_WISE_SIDS=219946_234020_216843_213350_214797_219943_213031_204901_230288_110085_236312_243706_243886_244723_245412_245654_232281_249910_247146_250890_251425_249892_252580_234295_253705_253877_253975_253427_240590_254473_251786_254733_250226_254769_253213_255640_254765_255956_234484_107312_256062_256094_252560_256083_255803_253993_255659_255476_256024_256225_256439_256505_254831_249406_256657_250842_256196_256739_251973_256228_248436_256587_257079_257105_257115_254144_257289_251068_256095_257333_257338_254317_251058_251133_254300_257437_255906_255324_257481_257542_257624_255177_257786_257940_257167_257903_258011_258032_257822_257586_257401_255224_257789_258053_253900_257262_8000084_8000118_8000133_8000136_8000150_8000184_8000186_8000203; H_WISE_SIDS_BFESS=219946_234020_216843_213350_214797_219943_213031_204901_230288_110085_236312_243706_243886_244723_245412_245654_232281_249910_247146_250890_251425_249892_252580_234295_253705_253877_253975_253427_240590_254473_251786_254733_250226_254769_253213_255640_254765_255956_234484_107312_256062_256094_252560_256083_255803_253993_255659_255476_256024_256225_256439_256505_254831_249406_256657_250842_256196_256739_251973_256228_248436_256587_257079_257105_257115_254144_257289_251068_256095_257333_257338_254317_251058_251133_254300_257437_255906_255324_257481_257542_257624_255177_257786_257940_257167_257903_258011_258032_257822_257586_257401_255224_257789_258053_253900_257262_8000084_8000118_8000133_8000136_8000150_8000184_8000186_8000203; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; BDUSS=xBeC1XWXRydHFRRGhTME9TY0JZOTNOSU1DV29KSmRTMEIxUjhtR1RaeWxqNGxrSUFBQUFBJCQAAAAAAAAAAAEAAACksY~2Y3MyNDgwNDE5MTcyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKUCYmSlAmJkMG; SIGNIN_UC=70a2711cf1d3d9b1a82d2f87d633bd8a04341572555Jj09f%2B1JwbsVmnf9ZBEVaMahnu01%2BpDEYXgPE0rHjT39860%2BODNpgIzWMavjWlZsSfqTBH4PigL14L%2Fw5elil87CBDcOu7mewQEs1I%2BUR7CBz8TEbxUNbHt3lCSQ0BG37PtRlyk50FZyWlshefDZv1s%2F%2F%2FblIHpFbwN%2FQAKKqSQyJALUZcR4%2Fx76yesrDuliq%2F0A1ESMvOgbtoZn9XDP3sRvcU1t9WjM47RFjSkBIwSRP438u%2BjsYhgXjsxi0W6PrjwwgioLaIarGiJh8RHpFDPE%2FsYVyZHI%2BTEj%2BsviMVA%3D00388323647644020228379653950655; bdindexid=dk8tr7uhjpef9ko4mqd0miuda2; BDUSS_BFESS=xBeC1XWXRydHFRRGhTME9TY0JZOTNOSU1DV29KSmRTMEIxUjhtR1RaeWxqNGxrSUFBQUFBJCQAAAAAAAAAAAEAAACksY~2Y3MyNDgwNDE5MTcyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKUCYmSlAmJkMG; H_PS_PSSID=38515_36555_38613_38538_38594_38595_36805_38485_38414_38637_26350_38567_38544; ab_sr=1.0.1_MmMyNWFjZDBkMDQ0NDAzYWE4OGQ4YzE0NGIyYjNkMmUzNjRjMWNmNWNhNzYwNmQ0ZTlmYWUxNzkwZDUxOTkyMmVkYzBlOWRmYzA1MjA5MTZjOTFlZjJjYmZiODk2ZjY0YWQ3Yzg3ZDY4ZjY5OWU2MjJhN2Y2ZGY1YjFlZWU5YTkzNzM3OGUzNmE3Y2E3NWE4YTNlOTNkODdjZWI3MDU1ZQ==; BAIDUID_BFESS=5F8E42119938A55E90637C029A4C140A:FG=1; delPer=0; BD_CK_SAM=1; PSINO=6; BA_HECTOR=01ag842g0l8hah05ag20043l1i641j01m; ZFY=:Ahph27sUibE2kfWteeiI4BQoR:ACQbrQKNEe6TR96SxM:C; H_PS_645EC=06bc%2BMMqlJRVgT%2FnEVTjjQLuNaCIN0cLMsgCk8Bwx6fh3TULTH4TOtg7KfY; BDSVRTM=99; H_PS_PSSID=38515_36555_38613_38538_38594_38595_36805_38485_38414_38637_26350_38567_38544; PSINO=6; delPer=0; BDSVRTM=25; BD_CK_SAM=1',
    'Referer': 'https://www.baidu.com/',
    'Upgrade-Insecure-Requests': '1',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36'
}


def get_data(url, p):
    html_data = requests.get(url=url,headers=headers,params=p)
    if html_data.status_code == 200:
        data = html_data.text
        # print(data)
        return data


def parse_data(data):

    data = re.sub('<a.*?>|</a>|<br\s/>|<img.*?>|<em>|</em>', '', data)
    lxml = etree.HTML(data)
    title = lxml.xpath('//div[@class="c-container"]//h3[@class="c-title t t tts-title"]//text()')
    place = lxml.xpath('//div[@class="c-container"]//span[@class="c-color-gray"]//text()')
    # print(len(title))
    # print(len(place))
    for t,p in zip(title,place):
        # t = re.sub('<a.*?>|</a>|<span.*?>|</span>|<br\s/>|<img.*?>|<em>|</em>', '', t)
        # p = re.sub('<a.*?>|</a>|<span.*?>|</span>|<br\s/>|<img.*?>|<em>|</em>', '', p)
        lst = []
        # print(t)
        # print(p)
        # print('===============')
        lst.append(t)
        lst.append(p)
        save_data(lst)

def save_data(lst):
    wb.append(lst)
    ws.save('云上数据.xlsx')

ws = workbook.Workbook()
wb = ws.active
try:
    for i in range(0,100):
        print('当前所在页: ',i)
        p['pn'] = i*10
        data = get_data(url, p)
        parse_data(data)
except Exception as e:
    print('错误信息：',e)
